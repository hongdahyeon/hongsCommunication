<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hongs.community.hongsCommunity.domain.report.HongBoardReportMapper">

    <select id="list" parameterType="HongBoardReportListDto" resultType="HongBoardReportListVo">
        /* board-report.list */
        select hbreport.hong_board_report_uid as report_uid
              ,hbreport.hong_board_type_uid as type_uid
              ,hbreport.report_title as title
              ,hbreport.report_content as content
              ,hbreport.file_uid as file_uid
              ,hbreport.notice_yn as notice_yn
              ,huser.user_name as reg_name
              ,to_char(hbreport.reg_dt, 'YYYY-MM-DD') as reg_dt
              ,( select count(*)
                   from hong_file hfile
                  where hfile.hong_file_uid = hbreport.file_uid
                    and hfile.delete_yn = 'N'
                    and hfile.saved = 'SAVED' ) as file_cnt
               ,( select count(*)
                    from hong_comment hcomment
                   where hcomment.target_id = hbreport.hong_board_report_uid
                     and hcomment.target_type = 'BOARD_REPORT_COMM' ) as comment_cnt
          from hong_board_report hbreport
         inner join hong_board_type hbtype on hbtype.hong_board_type_uid = hbreport.hong_board_type_uid
          left join hong_user huser on huser.user_uid = hbreport.reg_id
         where hbreport.hong_board_type_uid = #{typeUid}
           and hbreport.delete_yn = 'N'
    </select>

</mapper>